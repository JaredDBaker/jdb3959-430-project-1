<html>
  <head>
    <title>What if Client</title>
    <link href="default-styles.css" type="text/css" rel="stylesheet" />
    <script>
        const handleResponse = (e) => {
            console.log("e.target =", e.target); // here, `e.target` is the xhr object
            console.log("e.target.response = ", e.target.response); // so that mean this is a string of "joke" JSON
            const obj = JSON.parse(e.target.response); // turn it back into an object
            console.log("obj=", obj);
            // now go ahead and update #jokeContainewr with the contents of the joke
          let whatIf = document.querySelector("#whatIfContainer");

          if(e.target.responseURL.includes('list')){
            whatIf.innerHTML ="";
            for(let k = 0; k < obj.length; k+=1){
              whatIf.innerHTML += `
              <h3>${obj[k].q}</h3>
              <h4>Author: ${obj[k].author}</h4>
              <hr>
              `;
            }
          }
          else{
            whatIf.innerHTML = `
            <h3>${obj.q}</h3>
            <h4>Author: ${obj.author}</h4>
            <hr>
            <h4>Answers</h4>
            `;
            for(let i = 0; i < obj.a.length; i+=1){
              whatIf.innerHTML += `<p>${obj.a[i]}</p><hr>`;
            }
          }



        }
    
      const downloadWhatIf = (e) => {
        // remember that an `Event` object gets passed along every time that an event handler or listener calls a function
        // the `target` property of that event points at the element that sent the event, in this case a button
        console.log(`An element of id=${e.target.id} was clicked!`);
        let jokeURL;
        switch(e.target.id){
            case 'btnJoke':
                jokeURL = "/what-if";
                break;
            case 'btnWhatIfList':
                jokeURL = "/what-if-list?limit=5";
                break;
            default:
                jokeURL = "/what-if";
                break;
        }

        const xhr = new XMLHttpRequest();
        xhr.onload = handleResponse;
        xhr.open("GET", jokeURL);
        // with XHR, after we open a connection, but before we `send()`, we can set 1 or more HTTP request headers
        // this isn't strictly necessary because "/random-joke" sends JSON by default]
        xhr.setRequestHeader('Accept', "application/javascript");
        xhr.send();
      }
      
      const init = () => {
         // An Event *Handler*
        // document.querySelector("#btnJoke").onclick = downloadJoke; // same as below, less typing, use which ever version you prefer
      
        // An Event *Listener*
        document.querySelector("#btnWhatIf").addEventListener("click", downloadWhatIf);
        document.querySelector("#btnWhatIfList").addEventListener("click", downloadWhatIf);
      
        // **Actually, event handlers and listeners are NOT exactly the same in all use cases - what ARE the differences?**
      }
      
      window.onload = init;
     
    </script>
  </head>
  <body>
    <header>
      <nav>
        <a href="/home">Home</a>
        |
        <span id="current">App</span>
        |
        <a href="/suggest">Suggest</a>
        |
        <a href="/admin">Admin</a>
    </nav>
      <img src = '/triple' alt="What if repeated 3 times in different fonts">
    </header>
    
    <section>
      <h2>Find a What if?</h2>
      <p><button id="btnWhatIf">Find me a Question!</button> <button id ="btnWhatIfList">Show me a What if list!</button></p>
      <div id="whatIfContainer">
        
      </div>
    </section>
    
    
  </body>
</html>